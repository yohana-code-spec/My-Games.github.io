<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galaxy Defender Avanzado</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
    color: white;
    font-family: 'Arial', sans-serif;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: radial-gradient(circle at center, #0b0c1a 0%, #000000 100%);
  }
  #scoreboard {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 24px;
    font-weight: bold;
  }
</style>
</head>
<body>
<div id="scoreboard">Puntos: 0</div>
<canvas id="game" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const ship = {
  x: canvas.width/2,
  y: canvas.height - 60,
  width: 40,
  height: 40,
  speed: 5,
  color: '#00f0ff',
  bullets: []
};

let keys = {};
let asteroids = [];
let score = 0;
let gameOver = false;

// --- INPUT ---
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);
canvas.addEventListener('click', () => shoot());

// --- CLASES ---
class Enemy {
  constructor() {
    this.size = Math.random() * 20 + 20;
    this.x = Math.random() * canvas.width;
    this.y = -this.size;
    this.speed = Math.random() * 2 + 1;
    this.shape = ['circle','square','triangle'][Math.floor(Math.random()*3)];
    this.color = ['#f00','#0f0','#00f','#ff0','#f0f','#0ff'][Math.floor(Math.random()*6)];
  }
  update() { this.y += this.speed; }
  draw() {
    ctx.fillStyle = this.color;
    ctx.beginPath();
    if(this.shape==='circle') {
      ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
      ctx.fill();
    } else if(this.shape==='square') {
      ctx.fillRect(this.x-this.size/2,this.y-this.size/2,this.size,this.size);
    } else if(this.shape==='triangle') {
      ctx.moveTo(this.x,this.y-this.size/2);
      ctx.lineTo(this.x-this.size/2,this.y+this.size/2);
      ctx.lineTo(this.x+this.size/2,this.y+this.size/2);
      ctx.closePath();
      ctx.fill();
    }
  }
}

class Bullet {
  constructor(x,y) { this.x = x; this.y = y; this.radius = 5; this.speed = 7; }
  update() { this.y -= this.speed; }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
    ctx.fillStyle = '#ff0';
    ctx.fill();
  }
}

// --- FUNCIONES ---
function shoot() {
  ship.bullets.push(new Bullet(ship.x, ship.y - ship.height/2));
}

function update() {
  if(gameOver) return;

  // Movimiento nave
  if(keys['ArrowLeft'] && ship.x - ship.width/2 > 0) ship.x -= ship.speed;
  if(keys['ArrowRight'] && ship.x + ship.width/2 < canvas.width) ship.x += ship.speed;
  if(keys['ArrowUp'] && ship.y - ship.height/2 > 0) ship.y -= ship.speed;
  if(keys['ArrowDown'] && ship.y + ship.height/2 < canvas.height) ship.y += ship.speed;

  // Actualizar balas
  ship.bullets.forEach((b, i) => {
    b.update();
    if(b.y < 0) ship.bullets.splice(i,1);
  });

  // Actualizar enemigos
  asteroids.forEach((a,i) => {
    a.update();
    // Colisión con nave
    if(Math.hypot(a.x-ship.x, a.y-ship.y) < a.size + ship.width/2) gameOver = true;
    // Colisión con balas
    ship.bullets.forEach((b,j) => {
      if(Math.hypot(a.x-b.x,a.y-b.y) < a.size + b.radius) {
        asteroids.splice(i,1);
        ship.bullets.splice(j,1);
        score += 10;
        updateScore();
      }
    });
    if(a.y - a.size > canvas.height) asteroids.splice(i,1);
  });

  // Generar enemigos
  if(Math.random() < 0.02) asteroids.push(new Enemy());
}

function drawShip() {
  ctx.fillStyle = ship.color;
  ctx.beginPath();
  ctx.moveTo(ship.x, ship.y - ship.height/2);
  ctx.lineTo(ship.x - ship.width/2, ship.y + ship.height/2);
  ctx.lineTo(ship.x + ship.width/2, ship.y + ship.height/2);
  ctx.closePath();
  ctx.fill();
}

function draw() {
  // Fondo dinámico
  const gradient = ctx.createLinearGradient(0,0,0,canvas.height);
  gradient.addColorStop(0,'#0b0c1a');
  gradient.addColorStop(1,'#01010f');
  ctx.fillStyle = gradient;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  drawShip();
  ship.bullets.forEach(b => b.draw());
  asteroids.forEach(a => a.draw());

  if(gameOver){
    ctx.fillStyle = 'red';
    ctx.font = '50px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('GAME OVER', canvas.width/2, canvas.height/2);
    ctx.font = '20px Arial';
    ctx.fillText('Presiona F5 para reiniciar', canvas.width/2, canvas.height/2 + 40);
  }
}

function updateScore() {
  document.getElementById('scoreboard').textContent = 'Puntos: ' + score;
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

// --- INICIO ---
loop();
</script>
</body>
</html>
